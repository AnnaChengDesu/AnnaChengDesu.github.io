<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.119.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Anna.me</title><meta name=keywords content="Blog,Anna,love"><meta name=description content="With love in your heart, you will meet your better self!"><meta name=author content="Anna.me"><link rel=canonical href=https://annachengdesu.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.f2da42eb72c6ac4b82b92c21716a96ae77ab6a2505a713280483eee56482a913.css integrity="sha256-8tpC63LGrEuCuSwhcWqWrneraiUFpxMoBIPu5WSCqRM=" rel="preload stylesheet" as=style><link rel=icon href=https://annachengdesu.github.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://annachengdesu.github.io/index.xml><link rel=alternate type=application/json href=https://annachengdesu.github.io/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Anna.me"><meta property="og:description" content="With love in your heart, you will meet your better self!"><meta property="og:type" content="website"><meta property="og:url" content="https://annachengdesu.github.io/"><meta property="og:image" content="https://annachengdesu.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="Anna.me"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://annachengdesu.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Anna.me"><meta name=twitter:description content="With love in your heart, you will meet your better self!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Anna.me","url":"https://annachengdesu.github.io/","description":"With love in your heart, you will meet your better self!","thumbnailUrl":"https://annachengdesu.github.io/images/favicon.ico","sameAs":[]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://annachengdesu.github.io/ accesskey=h title="Anna.me (Alt + H)">Anna.me</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://annachengdesu.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://annachengdesu.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://annachengdesu.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://annachengdesu.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2>CI Runner并行处理job有概率出现报错内容缺失或出包内容错误</h2></header><div class=entry-content><p>问题描述：
前端仓库的 CI Runner 并行处理两个 job 有概率出现报错内容缺失或出包内容错误。
问题分析：
​ Gitlab 官方称：当只有一个 runner 在运行并且每个[[runner]] section 都有独立的 build 路径，concurrent 是生效的。若有多个 runner 使用同个 config.toml 文件或共享同个 build 路径，即使设置了 concurrent 为 1，也还是会有概率出现一个 runner 并发处理多个 job 的问题，官方认为这是用户的错误配置。config.toml 文件允许存在多个[[runner]] section，但这个 bug 会导致 concurrent 失效。
​ 根据上次 ci runner 出现打包内容错误的问题推测是当时 config.toml 配置上的失误，即多个 runner 使用同个 config.toml 文件并且没有指定 build_dir（默认对应于宿主机的目录是在宿主机 的 docker volume )，因此有概率出现一个 runner 同时处理两个 job 的情况(curcurrent 设置为 1)，再加上一个 runner 映射一个 volume，从 gitlab 上拉下的源代码都存储在同个 volume，后拉的替换先拉的，最终导致必有一个 job 打出的包有问题含有其他分支的内容或直接报错编译失败。
​ Branch_3.5.3 出的 sp4 包内容含其他分支的内容也就同样能解释通了，从下图中可以看出两次 job 先后执行并且持续了一段时间，但使用的是同一台 runner、同一个 volume，由于 Branch_3....</p></div><footer class=entry-footer><span title='2023-07-14 19:26:51 +0800 CST'>July 14, 2023</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;120 words&nbsp;·&nbsp;Anna.me</footer><a class=entry-link aria-label="post link to CI Runner并行处理job有概率出现报错内容缺失或出包内容错误" href=https://annachengdesu.github.io/post/problem-solved/gitlab-ci-cd/></a></article><article class=post-entry><header class=entry-header><h2>01-Command Pattern 命令模式-vanilla篇</h2></header><div class=entry-content><p>使用命令模式，可以将执行某个任务的对象与调用该方法的对象解耦。
假设有一个外卖配送平台。用户可以下单、跟踪和取消订单。
class OrderManager() { constructor() { this.orders = [] } placeOrder(order, id) { this.orders.push(id) return `You have successfully ordered ${order} (${id})`; } trackOrder(id) { return `Your order ${id} will arrive in 20 minutes.` } cancelOrder(id) { this.orders = this.orders.filter(order => order.id !== id) return `You have canceled your order ${id}` } } 在 OrderManager 类上，可以访问 placeOrder 、 trackOrder 和 cancelOrder 方法。直接使用这些方法将是完全可行的。
但是，直接在 manager 实例上调用方法也有缺点。我们可能会决定稍后重命名某些方法，或者改变某些方法的功能。
假设现在将其重命名为 addOrder ，而不是 placeOrder ，这意味着我们必须确保代码库中的没有任何位置调用 placeOrder 方法，这种场景在大型应用程序中可能非常棘手。相反，我们希望将方法与 manager 对象解耦，并为每个命令创建单独的命令函数。...</p></div><footer class=entry-footer><span title='2023-07-12 21:21:32 +0800 CST'>July 12, 2023</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;195 words&nbsp;·&nbsp;Anna.me</footer><a class=entry-link aria-label="post link to 01-Command Pattern 命令模式-vanilla篇" href=https://annachengdesu.github.io/post/patterns/command/></a></article><article class=post-entry><header class=entry-header><h2>Redux与Redux-Toolkit的实现对比</h2></header><div class=entry-content><p>Redux 基本概念与 API Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。
Store对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。
State 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。
Action 是一个对象。其中的type属性是必须的，表示 Action 的名称。
Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。
Reducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。
Store 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。
store 的三个方法 store.getState() // 获取当前 state store.dispatch() // 派发 action 至 reducer 处理 store.subscribe() // 订阅事件 state 变化即触发 示例代码 实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。
&lt;!DOCTYPE html> &lt;html lang="en"> &lt;head> &lt;meta charset="UTF-8" /> &lt;meta name="viewport" content="width=device-width, initial-scale=1....</p></div><footer class=entry-footer><span title='2023-06-10 16:32:13 +0800 CST'>June 10, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;723 words&nbsp;·&nbsp;Anna.me</footer><a class=entry-link aria-label="post link to Redux与Redux-Toolkit的实现对比" href=https://annachengdesu.github.io/post/react/redux/></a></article><article class=post-entry><header class=entry-header><h2>TypeScript练习题：30天LeetCode挑战（day1 to day7）</h2></header><div class=entry-content><p>LeetCode 挑战题目汇总地址： 30 Days of JavaScript Challenge
DAY1: Create Hello World Function 解题代码： function createHelloWorld() { return function(...args): string { return "Hello World" }; }; 官方解題說明
https://leetcode.com/problems/create-hello-world-function/editorial/
DAY2: Counter 题目说明： 第一次调用 createCounter 传值 n, 后面每次调用返回都比前一次返回的值加1。
解题思路： 可以用变量和运算符的相对位置来记递增运算符返回的值是计算前还是计算后的值：n++ 的 n 放在 ++ 的前面，所以是运算前的值；++n 是放在 ++ 的后面，所以是运算后的值。
function createCounter(n: number): () => number { return function() { return n++ } } 官方解題說明
https://leetcode.com/problems/counter/editorial/
DAY3: Counter II 题目说明： 实现函数 createCounter，可以传一个初始值参数，返回包含三个函数的对象，三个函数分别是 increment()、decrement()、reset()。
解题思路： increment()、decrement() 都是返回计算过后的值，变量要放在运算符的后面。reset() 重置初始值，需要额外用变量储存当前计算值，保留初始值 init。...</p></div><footer class=entry-footer><span title='2023-02-20 14:08:56 +0800 CST'>February 20, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;372 words&nbsp;·&nbsp;Anna.me</footer><a class=entry-link aria-label="post link to TypeScript练习题：30天LeetCode挑战（day1 to day7）" href=https://annachengdesu.github.io/post/ts-test-30-days/day1to7/></a></article><article class=post-entry><header class=entry-header><h2>一句话概括防抖和节流的区别</h2></header><div class=entry-content><p>防抖 防抖函数原理：把触发非常频繁的事件合并成一次去执行 在指定时间内只执行一次回调函数，如果在指定的时间内又触发了该事件，则回调函数的执行时间会基于此刻重新开始计算
简易手写版： // func是用户传入需要防抖的函数 // wait是等待时间 const debounce = (func, wait) => { let timer = undefined; // 这里返回的函数是每次用户实际调用的防抖函数 // 如果已经设定过定时器了就清空上一次的定时器 // 开始一个新的定时器，延迟执行用户传入的方法 return function (...args) { if (timer) clearTimeout(timer); timer = setTimeout(() => { func.apply(this, args); }, wait); }; }; 适用场景：
文本输入的验证，连续输入文字后发送 AJAX 请求进行验证，验证一次就好 按钮提交场景：防止多次提交按钮，只执行最后提交的一次 服务端验证场景：表单验证需要服务端配合，只执行一段连续的输入事件的最后一次，还有搜索联想词功能类似 节流 节流函数原理:指频繁触发事件时，只会在指定的时间段内执行事件回调，即触发事件间隔大于等于指定的时间才会执行回调函数。总结起来就是：事件按照一段时间的间隔来进行触发。
简易手写版： 时间戳实现
const throttle = (func, wait = 50) => { let lastTime = 0; return function (...args) { let now = Date....</p></div><footer class=entry-footer><span title='2023-01-10 20:11:25 +0800 CST'>January 10, 2023</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;146 words&nbsp;·&nbsp;Anna.me</footer><a class=entry-link aria-label="post link to 一句话概括防抖和节流的区别" href=https://annachengdesu.github.io/post/javascript/debounce-and-throttle/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://annachengdesu.github.io/page/2/>«&nbsp;Prev&nbsp;</a>
<a class=next href=https://annachengdesu.github.io/page/4/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://annachengdesu.github.io/>Anna.me</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>