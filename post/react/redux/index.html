<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Redux与Redux-Toolkit的实现对比 | Anna.me</title><meta name=keywords content="Redux,Redux-Toolkit"><meta name=description content="Redux 基本概念与 API Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。
Store对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。
State 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。
Action 是一个对象。其中的type属性是必须的，表示 Action 的名称。
Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。
Reducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。
Store 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。
store 的三个方法 store.getState() // 获取当前 state store.dispatch() // 派发 action 至 reducer 处理 store.subscribe() // 订阅事件 state 变化即触发 示例代码 实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。
<!DOCTYPE html> <html lang=&#34;en&#34;> <head> <meta charset=&#34;UTF-8&#34; /> <meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1."><meta name=author content="Anna.me"><link rel=canonical href=https://annachengdesu.github.io/post/react/redux/><link crossorigin=anonymous href=/assets/css/stylesheet.f2da42eb72c6ac4b82b92c21716a96ae77ab6a2505a713280483eee56482a913.css integrity="sha256-8tpC63LGrEuCuSwhcWqWrneraiUFpxMoBIPu5WSCqRM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://annachengdesu.github.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://annachengdesu.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Redux与Redux-Toolkit的实现对比"><meta property="og:description" content="Redux 基本概念与 API Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。
Store对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。
State 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。
Action 是一个对象。其中的type属性是必须的，表示 Action 的名称。
Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。
Reducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。
Store 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。
store 的三个方法 store.getState() // 获取当前 state store.dispatch() // 派发 action 至 reducer 处理 store.subscribe() // 订阅事件 state 变化即触发 示例代码 实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。
<!DOCTYPE html> <html lang=&#34;en&#34;> <head> <meta charset=&#34;UTF-8&#34; /> <meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1."><meta property="og:type" content="article"><meta property="og:url" content="https://annachengdesu.github.io/post/react/redux/"><meta property="og:image" content="https://annachengdesu.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-06-10T16:32:13+08:00"><meta property="article:modified_time" content="2023-06-10T16:32:13+08:00"><meta property="og:site_name" content="Anna.me"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://annachengdesu.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Redux与Redux-Toolkit的实现对比"><meta name=twitter:description content="Redux 基本概念与 API Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。
Store对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。
State 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。
Action 是一个对象。其中的type属性是必须的，表示 Action 的名称。
Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。
Reducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。
Store 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。
store 的三个方法 store.getState() // 获取当前 state store.dispatch() // 派发 action 至 reducer 处理 store.subscribe() // 订阅事件 state 变化即触发 示例代码 实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。
<!DOCTYPE html> <html lang=&#34;en&#34;> <head> <meta charset=&#34;UTF-8&#34; /> <meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://annachengdesu.github.io/post/"},{"@type":"ListItem","position":2,"name":"Redux与Redux-Toolkit的实现对比","item":"https://annachengdesu.github.io/post/react/redux/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Redux与Redux-Toolkit的实现对比","name":"Redux与Redux-Toolkit的实现对比","description":"Redux 基本概念与 API Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。\nStore对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。\nState 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。\nAction 是一个对象。其中的type属性是必须的，表示 Action 的名称。\nAction 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。\nReducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。\nStore 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。\nstore 的三个方法 store.getState() // 获取当前 state store.dispatch() // 派发 action 至 reducer 处理 store.subscribe() // 订阅事件 state 变化即触发 示例代码 实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.","keywords":["Redux","Redux-Toolkit"],"articleBody":"Redux 基本概念与 API Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。\nStore对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。\nState 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。\nAction 是一个对象。其中的type属性是必须的，表示 Action 的名称。\nAction 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。\nReducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。\nStore 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。\nstore 的三个方法 store.getState() // 获取当前 state store.dispatch() // 派发 action 至 reducer 处理 store.subscribe() // 订阅事件 state 变化即触发 示例代码 实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。\n\u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\" /\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e \u003ctitle\u003eRedux example\u003c/title\u003e \u003clink rel=\"stylesheet\" href=\"style.css\" /\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"app\"\u003e \u003cdiv id=\"addBook\"\u003e \u003cinput id=\"addInput\" type=\"text\" /\u003e \u003cbutton id=\"addBtn\"\u003eADD Book\u003c/button\u003e \u003c/div\u003e \u003cdiv id=\"delBook\"\u003e \u003cinput id=\"delInput\" type=\"text\" /\u003e \u003cbutton id=\"delBtn\"\u003eDEL Book\u003c/button\u003e \u003c/div\u003e \u003col id=\"bookList\"\u003e\u003c/ol\u003e \u003c/div\u003e \u003cscript src=\"app.js\"\u003e\u003c/script\u003e \u003c/body\u003e \u003c/html\u003e import { legacy_createStore as createStore } from \"redux\"; const initialState = []; let recordState; const reducer = (state = initialState, action) =\u003e { recordState = state; switch (action.type) { case \"ADD_BOOK\": return [ ...state, { bookId: action.info.bookId, bookName: action.info.bookName, }, ]; case \"DEL_BOOK\": return state.filter((book) =\u003e book.bookId != action.info.bookId); default: return [...state]; } }; const store = createStore(reducer); const addInput = document.getElementById(\"addInput\"); const delInput = document.getElementById(\"delInput\"); const addBtn = document.getElementById(\"addBtn\"); const delBtn = document.getElementById(\"delBtn\"); const bookList = document.getElementById(\"bookList\"); function* generateId() { let i = 0; while (true) { yield ++i; } } const generateID = generateId(); const bookId = () =\u003e generateID.next().value; function addBookFn() { const bookName = addInput.value; if (bookName.trim()) { addInput.value = \"\"; const id = bookId(); store.dispatch({ type: \"ADD_BOOK\", info: { bookName, bookId: id, }, }); } } function delBookFn() { const bookId = delInput.value.trim(); const books = store.getState(); const isExist = books.find((book) =\u003e book.bookId == bookId); if (isExist) { delInput.value = \"\"; store.dispatch({ type: \"DEL_BOOK\", info: { bookId, }, }); } } addBtn.addEventListener(\"click\", addBookFn); delBtn.addEventListener(\"click\", delBookFn); function createBookItem(book) { const element = document.createElement(\"li\"); element.innerText = `BookID: ${book.bookId} Name: ${book.bookName}`; return element; } const showBookList = store.subscribe(() =\u003e { const newBookList = store.getState(); if (newBookList.length !== recordState.length) { bookList.innerText = \"\"; newBookList.forEach((book) =\u003e { bookList.appendChild(createBookItem(book)); }); } }); 直接使用 Redux 存在的常见问题 配置复杂，devtool… 模板代码太多，创建 constant，action，reducer… 需要添加很多依赖包，如 redux-thunk、immer… Redux-toolkit 解决了哪些问题 configureStore() 包裹 createStore，并集成了redux-thunk、Redux DevTools Extension，默认开启\ncreateReducer() 创建一个 reducer，action type 映射到 case reducer 函数中，不用写 switch-case，并集成`immer\ncreateAction() 创建一个 action，传入动作类型字符串，返回动作函数\ncreateSlice() 创建一个 slice，包含 createReducer、createAction 的所有功能\ncreateAsyncThunk() 创建一个 thunk，接受一个动作类型字符串和一个 Promise 的函数\nRedux-toolkit 替换 Redex 示例代码 安装@reduxjs/toolkit # 使用 npm\rnpm install @reduxjs/toolkit\r# 使用 yarn\ryarn add @reduxjs/toolkit configureStore 替换 createStore import React from \"react\"; import { render } from \"react-dom\"; // import { createStore } from \"redux\"; import { configureStore } from \"@reduxjs/toolkit\"; import { Provider } from \"react-redux\"; import App from \"./components/App\"; import rootReducer from \"./reducers\"; // const store = createStore(rootReducer); const store = configureStore({ reducer: rootReducer, }); 创建 Action # 创建 action const increment = createAction('INCREMENT') const decrement = createAction('DECREMENT') # 创建reducer const counter = createReducer(0, { [increment]: state =\u003e state + 1, [decrement]: state =\u003e state - 1 }) 以上看起比原来结构上好一些，创建 action、reducer 方便了，但是看着还是不爽，action 也可以去掉。\n创建 Slice const counterSlice = createSlice({ name: 'counter', initialState: 0, reducers: { increment: state =\u003e state + 1, decrement: state =\u003e state - 1 } }) # action counterSlice.action; # reducer counterSlice.reducer; 完整 slice import { createSlice, PayloadAction } from \"@reduxjs/toolkit\"; import { AppThunk, RootState } from \"../../app/store\"; interface CounterState { value: number; } const initialState: CounterState = { value: 0, }; export const counterSlice = createSlice({ name: \"counter\", initialState, reducers: { increment: (state) =\u003e { state.value += 1; }, decrement: (state) =\u003e { state.value -= 1; }, incrementByAmount: (state, action: PayloadAction\u003cnumber\u003e) =\u003e { state.value += action.payload; }, }, }); export const { increment, decrement, incrementByAmount } = counterSlice.actions; export const incrementAsync = (amount: number): AppThunk =\u003e (dispatch) =\u003e { setTimeout(() =\u003e { dispatch(incrementByAmount(amount)); }, 1000); }; export const selectCount = (state: RootState) =\u003e state.counter.value; export default counterSlice.reducer; import React, { useState } from \"react\"; import { useSelector, useDispatch } from \"react-redux\"; import { decrement, increment, incrementByAmount, incrementAsync, selectCount, } from \"./counterSlice\"; import styles from \"./Counter.module.css\"; export function Counter() { const count = useSelector(selectCount); const dispatch = useDispatch(); const [incrementAmount, setIncrementAmount] = useState(\"2\"); return ( \u003cdiv\u003e \u003cdiv className={styles.row}\u003e \u003cbutton className={styles.button} aria-label=\"Increment value\" onClick={() =\u003e dispatch(increment())} \u003e + \u003c/button\u003e \u003cspan className={styles.value}\u003e{count}\u003c/span\u003e \u003cbutton className={styles.button} aria-label=\"Decrement value\" onClick={() =\u003e dispatch(decrement())} \u003e - \u003c/button\u003e \u003c/div\u003e \u003cdiv className={styles.row}\u003e \u003cinput className={styles.textbox} aria-label=\"Set increment amount\" value={incrementAmount} onChange={(e) =\u003e setIncrementAmount(e.target.value)} /\u003e \u003cbutton className={styles.button} onClick={() =\u003e dispatch(incrementByAmount(Number(incrementAmount) || 0)) } \u003e Add Amount \u003c/button\u003e \u003cbutton className={styles.asyncButton} onClick={() =\u003e dispatch(incrementAsync(Number(incrementAmount) || 0)) } \u003e Add Async \u003c/button\u003e \u003c/div\u003e \u003c/div\u003e ); } ","wordCount":"723","inLanguage":"en","datePublished":"2023-06-10T16:32:13+08:00","dateModified":"2023-06-10T16:32:13+08:00","author":{"@type":"Person","name":"Anna.me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://annachengdesu.github.io/post/react/redux/"},"publisher":{"@type":"Organization","name":"Anna.me","logo":{"@type":"ImageObject","url":"https://annachengdesu.github.io/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://annachengdesu.github.io/ accesskey=h title="Anna.me (Alt + H)">Anna.me</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://annachengdesu.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://annachengdesu.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://annachengdesu.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://annachengdesu.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://annachengdesu.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://annachengdesu.github.io/post/>Posts</a></div><h1 class=post-title>Redux与Redux-Toolkit的实现对比</h1><div class=post-meta><span title='2023-06-10 16:32:13 +0800 CST'>June 10, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;723 words&nbsp;·&nbsp;Anna.me</div></header><div class=post-content><h2 id=redux-基本概念与-api>Redux 基本概念与 API<a hidden class=anchor aria-hidden=true href=#redux-基本概念与-api>#</a></h2><p>Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。</p><p><code>Store</code>对象包含所有数据。如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。</p><p>State 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。</p><p>Action 是一个对象。其中的<code>type</code>属性是必须的，表示 Action 的名称。</p><p>Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。</p><p>Reducer 是一个函数，它接受 当前 State 和 Action 作为参数，返回一个新的 State。</p><p>Store 允许使用<code>store.subscribe</code>方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。</p><h3 id=store-的三个方法>store 的三个方法<a hidden class=anchor aria-hidden=true href=#store-的三个方法>#</a></h3><ul><li>store.getState() // 获取当前 state</li><li>store.dispatch() // 派发 action 至 reducer 处理</li><li>store.subscribe() // 订阅事件 state 变化即触发</li></ul><p><img loading=lazy src=D:%5cHugo%5cSites%5canna.me%5cassets%5cimg%5cRedux.png alt></p><h2 id=示例代码>示例代码<a hidden class=anchor aria-hidden=true href=#示例代码>#</a></h2><p>实现一个能够添加书籍，并能够根据书籍 ID 删除的功能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Redux example<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;style.css&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;app&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;addBook&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;addInput&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;addBtn&#34;</span><span class=p>&gt;</span>ADD Book<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;delBook&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;delInput&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;delBtn&#34;</span><span class=p>&gt;</span>DEL Book<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>ol</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;bookList&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>ol</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;app.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>legacy_createStore</span> <span class=nx>as</span> <span class=nx>createStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;redux&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>initialState</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>recordState</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>reducer</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>initialState</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>recordState</span> <span class=o>=</span> <span class=nx>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>action</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;ADD_BOOK&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span><span class=nx>state</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>bookId</span><span class=o>:</span> <span class=nx>action</span><span class=p>.</span><span class=nx>info</span><span class=p>.</span><span class=nx>bookId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>bookName</span><span class=o>:</span> <span class=nx>action</span><span class=p>.</span><span class=nx>info</span><span class=p>.</span><span class=nx>bookName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;DEL_BOOK&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>state</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>book</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>book</span><span class=p>.</span><span class=nx>bookId</span> <span class=o>!=</span> <span class=nx>action</span><span class=p>.</span><span class=nx>info</span><span class=p>.</span><span class=nx>bookId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>[...</span><span class=nx>state</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>createStore</span><span class=p>(</span><span class=nx>reducer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>addInput</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;addInput&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>delInput</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;delInput&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>addBtn</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;addBtn&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>delBtn</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;delBtn&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bookList</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;bookList&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=o>*</span> <span class=nx>generateId</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>yield</span> <span class=o>++</span><span class=nx>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>generateID</span> <span class=o>=</span> <span class=nx>generateId</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bookId</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>generateID</span><span class=p>.</span><span class=nx>next</span><span class=p>().</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>addBookFn</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>bookName</span> <span class=o>=</span> <span class=nx>addInput</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>bookName</span><span class=p>.</span><span class=nx>trim</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>addInput</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>bookId</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>store</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;ADD_BOOK&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bookName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>bookId</span><span class=o>:</span> <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>delBookFn</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>bookId</span> <span class=o>=</span> <span class=nx>delInput</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>trim</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>books</span> <span class=o>=</span> <span class=nx>store</span><span class=p>.</span><span class=nx>getState</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>isExist</span> <span class=o>=</span> <span class=nx>books</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>book</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>book</span><span class=p>.</span><span class=nx>bookId</span> <span class=o>==</span> <span class=nx>bookId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isExist</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>delInput</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>store</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;DEL_BOOK&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>info</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>bookId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>addBtn</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=nx>addBookFn</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>delBtn</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=nx>delBookFn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createBookItem</span><span class=p>(</span><span class=nx>book</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>element</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;li&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>element</span><span class=p>.</span><span class=nx>innerText</span> <span class=o>=</span> <span class=sb>`BookID: </span><span class=si>${</span><span class=nx>book</span><span class=p>.</span><span class=nx>bookId</span><span class=si>}</span><span class=sb> Name: </span><span class=si>${</span><span class=nx>book</span><span class=p>.</span><span class=nx>bookName</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>element</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>showBookList</span> <span class=o>=</span> <span class=nx>store</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>newBookList</span> <span class=o>=</span> <span class=nx>store</span><span class=p>.</span><span class=nx>getState</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>newBookList</span><span class=p>.</span><span class=nx>length</span> <span class=o>!==</span> <span class=nx>recordState</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>bookList</span><span class=p>.</span><span class=nx>innerText</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>newBookList</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>book</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>bookList</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>createBookItem</span><span class=p>(</span><span class=nx>book</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=直接使用-redux-存在的常见问题>直接使用 Redux 存在的常见问题<a hidden class=anchor aria-hidden=true href=#直接使用-redux-存在的常见问题>#</a></h2><ul><li>配置复杂，devtool&mldr;</li><li>模板代码太多，创建 constant，action，reducer&mldr;</li><li>需要添加很多依赖包，如 redux-thunk、immer&mldr;</li></ul><h2 id=redux-toolkit-解决了哪些问题>Redux-toolkit 解决了哪些问题<a hidden class=anchor aria-hidden=true href=#redux-toolkit-解决了哪些问题>#</a></h2><p><code>configureStore()</code> 包裹 createStore，并集成了<code>redux-thunk</code>、<code>Redux DevTools Extension</code>，默认开启</p><p><code>createReducer()</code> 创建一个 reducer，action type 映射到 case reducer 函数中，不用写 switch-case，并集成`immer</p><p><code>createAction()</code> 创建一个 action，传入动作类型字符串，返回动作函数</p><p><code>createSlice()</code> 创建一个 slice，包含 createReducer、createAction 的所有功能</p><p><code>createAsyncThunk()</code> 创建一个 thunk，接受一个动作类型字符串和一个 Promise 的函数</p><h2 id=redux-toolkit-替换-redex-示例代码>Redux-toolkit 替换 Redex 示例代码<a hidden class=anchor aria-hidden=true href=#redux-toolkit-替换-redex-示例代码>#</a></h2><ol><li><h5 id=安装reduxjstoolkit>安装@reduxjs/toolkit<a hidden class=anchor aria-hidden=true href=#安装reduxjstoolkit>#</a></h5><pre tabindex=0><code># 使用 npm
npm install @reduxjs/toolkit

# 使用 yarn
yarn add @reduxjs/toolkit
</code></pre></li><li><h5 id=configurestore-替换-createstore>configureStore 替换 createStore<a hidden class=anchor aria-hidden=true href=#configurestore-替换-createstore>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>render</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react-dom&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// import { createStore } from &#34;redux&#34;;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>configureStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@reduxjs/toolkit&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Provider</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react-redux&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s2>&#34;./components/App&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>rootReducer</span> <span class=nx>from</span> <span class=s2>&#34;./reducers&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// const store = createStore(rootReducer);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>configureStore</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>reducer</span><span class=o>:</span> <span class=nx>rootReducer</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div></li><li><h5 id=创建-action>创建 Action<a hidden class=anchor aria-hidden=true href=#创建-action>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>#</span> <span class=nx>创建</span> <span class=nx>action</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=nx>createAction</span><span class=p>(</span><span class=s1>&#39;INCREMENT&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=nx>createAction</span><span class=p>(</span><span class=s1>&#39;DECREMENT&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>创建reducer</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>createReducer</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nx>increment</span><span class=p>]</span><span class=o>:</span> <span class=nx>state</span> <span class=p>=&gt;</span> <span class=nx>state</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nx>decrement</span><span class=p>]</span><span class=o>:</span> <span class=nx>state</span> <span class=p>=&gt;</span> <span class=nx>state</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>以上看起比原来结构上好一些，创建 action、reducer 方便了，但是看着还是不爽，action 也可以去掉。</p></li><li><h5 id=创建-slice>创建 Slice<a hidden class=anchor aria-hidden=true href=#创建-slice>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counterSlice</span> <span class=o>=</span> <span class=nx>createSlice</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;counter&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>initialState</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>reducers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=o>:</span> <span class=nx>state</span> <span class=p>=&gt;</span> <span class=nx>state</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=o>:</span> <span class=nx>state</span> <span class=p>=&gt;</span> <span class=nx>state</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>action</span>
</span></span><span class=line><span class=cl><span class=nx>counterSlice</span><span class=p>.</span><span class=nx>action</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>reducer</span>
</span></span><span class=line><span class=cl><span class=nx>counterSlice</span><span class=p>.</span><span class=nx>reducer</span><span class=p>;</span>
</span></span></code></pre></div></li><li><h5 id=完整-slice>完整 slice<a hidden class=anchor aria-hidden=true href=#完整-slice>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createSlice</span><span class=p>,</span> <span class=nx>PayloadAction</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@reduxjs/toolkit&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>AppThunk</span><span class=p>,</span> <span class=nx>RootState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;../../app/store&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>CounterState</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span><span class=o>:</span> <span class=nx>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>initialState</span><span class=o>:</span> <span class=nx>CounterState</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>counterSlice</span> <span class=o>=</span> <span class=nx>createSlice</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;counter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>initialState</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>reducers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=o>:</span> <span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>state</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=o>:</span> <span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>state</span><span class=p>.</span><span class=nx>value</span> <span class=o>-=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>incrementByAmount</span><span class=o>:</span> <span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=o>:</span> <span class=nx>PayloadAction</span><span class=o>&lt;</span><span class=nx>number</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>state</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=nx>action</span><span class=p>.</span><span class=nx>payload</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=p>{</span> <span class=nx>increment</span><span class=p>,</span> <span class=nx>decrement</span><span class=p>,</span> <span class=nx>incrementByAmount</span> <span class=p>}</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=nx>counterSlice</span><span class=p>.</span><span class=nx>actions</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>incrementAsync</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>amount</span><span class=o>:</span> <span class=nx>number</span><span class=p>)</span><span class=o>:</span> <span class=nx>AppThunk</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nx>dispatch</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>dispatch</span><span class=p>(</span><span class=nx>incrementByAmount</span><span class=p>(</span><span class=nx>amount</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>selectCount</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span><span class=o>:</span> <span class=nx>RootState</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>state</span><span class=p>.</span><span class=nx>counter</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>counterSlice</span><span class=p>.</span><span class=nx>reducer</span><span class=p>;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useSelector</span><span class=p>,</span> <span class=nx>useDispatch</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react-redux&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>decrement</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>increment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>incrementByAmount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>incrementAsync</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>selectCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;./counterSlice&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>styles</span> <span class=nx>from</span> <span class=s2>&#34;./Counter.module.css&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>Counter</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>useSelector</span><span class=p>(</span><span class=nx>selectCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>dispatch</span> <span class=o>=</span> <span class=nx>useDispatch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>incrementAmount</span><span class=p>,</span> <span class=nx>setIncrementAmount</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>row</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>button</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>button</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>aria</span><span class=o>-</span><span class=nx>label</span><span class=o>=</span><span class=s2>&#34;Increment value&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>dispatch</span><span class=p>(</span><span class=nx>increment</span><span class=p>())}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>+</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>span</span> <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>value</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>count</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/span&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>button</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>button</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>aria</span><span class=o>-</span><span class=nx>label</span><span class=o>=</span><span class=s2>&#34;Decrement value&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>dispatch</span><span class=p>(</span><span class=nx>decrement</span><span class=p>())}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>-</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>row</span><span class=p>}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>input</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>textbox</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>aria</span><span class=o>-</span><span class=nx>label</span><span class=o>=</span><span class=s2>&#34;Set increment amount&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>incrementAmount</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setIncrementAmount</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>button</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>button</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nx>dispatch</span><span class=p>(</span><span class=nx>incrementByAmount</span><span class=p>(</span><span class=nb>Number</span><span class=p>(</span><span class=nx>incrementAmount</span><span class=p>)</span> <span class=o>||</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>Add</span> <span class=nx>Amount</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>button</span>
</span></span><span class=line><span class=cl>          <span class=nx>className</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>asyncButton</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nx>dispatch</span><span class=p>(</span><span class=nx>incrementAsync</span><span class=p>(</span><span class=nb>Number</span><span class=p>(</span><span class=nx>incrementAmount</span><span class=p>)</span> <span class=o>||</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>Add</span> <span class=nx>Async</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://annachengdesu.github.io/tags/redux/>Redux</a></li><li><a href=https://annachengdesu.github.io/tags/redux-toolkit/>Redux-Toolkit</a></li></ul><nav class=paginav><a class=prev href=https://annachengdesu.github.io/post/patterns/command/><span class=title>« Prev</span><br><span>01-Command Pattern 命令模式-vanilla篇</span></a>
<a class=next href=https://annachengdesu.github.io/post/ts-test-30-days/day1to7/><span class=title>Next »</span><br><span>TypeScript练习题：30天LeetCode挑战（day1 to day7）</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://annachengdesu.github.io/>Anna.me</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>